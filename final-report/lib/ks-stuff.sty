\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ks-stuff}[2022/02/08 Miscellaneous utilities for final report snippets]

\RequirePackage{mathtools}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{thmtools}
\RequirePackage{isomath}
\RequirePackage{microtype}
\RequirePackage{parskip}

\RequirePackage[normalem]{ulem}

\RequirePackage{fontspec}
\RequirePackage{lmodern}
\RequirePackage[math-style=ISO]{unicode-math}
\RequirePackage{libertinus}
\renewcommand\familydefault\sfdefault

\defaultfontfeatures{}
\setmonofont{JuliaMono}[%
  Extension=.ttf,%
  UprightFont=*-Regular,%
  BoldFont=*-Bold,%
  ItalicFont=*-RegularItalic,%
  BoldItalicFont=*-BoldItalic,%
  Scale=MatchLowercase,%
]


\RequirePackage{enumitem}
\setlist[enumerate]{
  font=\color{gray!50!black},
}
\setlist[itemize]{
  font=\color{gray!50!black},
  left=1em .. 2em,
}
\setlist[enumerate, 1]{
  label=[\arabic*],
  left=.5em .. 2em,
}
\setlistdepth{10}

\newcommand\ks@math@IffLabel[1]{\ifcase#1\or\ensuremath{⇒}\or\ensuremath{⇐}\else\fi}
\newcommand\IffLabel[1]{\ks@math@IffLabel{\value{#1}}}
\AddEnumerateCounter{\IffLabel}{\ks@math@IffLabel}{1}
\newlist{ifflist}{enumerate}{1}
\setlist[ifflist]{
  font=\color{gray!50!black},
  label=[\IffLabel*],
  left=.5em .. 2em,
}

\RequirePackage{amsthm}
\RequirePackage{thmtools}

\declaretheoremstyle[%
  %spaceabove=0pt,
  bodyfont=\normalfont,
]{theorem}

\RequirePackage{tcolorbox}
\tcbuselibrary{breakable}
\tcbuselibrary{theorems}


\tcbsetforeverylayer{
  shade box/.style={
    boxrule=0pt,
    top=1em,
    bottom=1em,
    sharp corners,
    breakable,
    parbox=false,
    boxsep=0pt,
    opacityframe=0,
    opacityback=1/16,
    colback=#1,
  },
  thm/.style={},
  theorem/.style={
    enhanced jigsaw,
    sharp corners,
    boxrule=1pt/2,
    colframe=#1,
    colback=#1,
    opacityback=0,%1/8,
    %opacityframe=0,
    opacityframe=1/2,
    colbacktitle=#1,
    opacitybacktitle=1/4,
    coltitle=black,
    fonttitle=\bfseries,
    boxsep=0em,
    left=1em,
    right=1em,
    top=1em/2,
    bottom=1em/2,
    toptitle=1em/2,
    bottomtitle=1em/2,
    parbox=false,
    breakable,
    separator sign={\ \textcolor{#1!50!black!50}{\(▶\)}},
    %separator sign={\ \tikz[baseline={(0,0)}]{\node[opacity=1/2, inner ysep=0pt, inner xsep=1em/4, outer sep=0pt, anchor=base]{\(▶\)}}},
  },
}

\tcolorboxenvironment{proof}{
  boxrule=.5pt,
  top=1em,
  bottom=1em,
  sharp corners,
  breakable,
  parbox=false,
  boxsep=0pt,
  opacityframe=1/2,
  %opacityback=1/16,
  opacityback=0,
  colframe=teal,
  enhanced jigsaw,
}


%\tcolorboxenvironment{definition}{
%  thm=green!50!blue,
%}
%\tcolorboxenvironment{theorem}{
%  thm=blue!50!teal,
%}
%\tcolorboxenvironment{conjecture}{
%  thm=teal,
%}



\RequirePackage{minted}

\newtcolorbox{annotation}{
  breakable,
  sharp corners,
  opacityframe=0,
  opacityback=0,
  boxsep=0pt,
  right=0em,
  left=2em,
  parbox=false,
}

\newenvironment{nest}{%
  \begin{list}{}{%
      \setlength{\parskip}{0pt}%
      \setlength{\topsep}{0pt}%
      \setlength{\partopsep}{0pt}%
      \setlength{\itemsep}{0pt}%
      \setlength{\leftmargin}{1.5em}%
    }\item%
}{\end{list}}
%\newtcolorbox{nested}{
%  breakable,
%  parbox=false,
%  % TODO fix spacing, maybe try `before skip balanced`, requires newer
%  % tcolorbox.  or use a list with empty labels instead!
%  %before=\\,
%  sharp corners,
%  opacityback=0,
%  opacityframe=0,
%  boxsep=0pt,
%  boxrule=0pt,
%  right=0em,
%  top=1em/2,
%  %top=0pt,
%  bottom=0pt,
%  left=2em,
%}
\newtcolorbox{aside}{
  %shade box=black,
  before upper=\tikz{\node[inner sep=0pt, opacity=1/2]{\scshape\bfseries Aside}}\hspace{.5em},
  breakable,
  parbox=false,
  enhanced jigsaw,
  sharp corners,
  opacityback=0,
  boxsep=0pt,
  colframe=black,
  opacityframe=1/4,
  left=1em,
  right=0em,
  top=0em,
  bottom=0em,
  boxrule=0pt,
  leftrule=1em/4,
}

\RequirePackage{tikz}

\RequirePackage{hyperref}
\RequirePackage[nameinlink]{cleveref}
\hypersetup{
  pdfborder={0 0 1},
  unicode=true,
  colorlinks=true,
  urlcolor=blue!25!teal,
  linkcolor=green!50!brown!50!black,
  citecolor=green!50!brown!50!black,
}
\crefname{figure}{figure}{figures}
\Crefname{figure}{Figure}{Figures}

\RequirePackage{titlesec}
\RequirePackage[Smaller]{cancel}

\RequirePackage{array}

\RequirePackage{booktabs}
\RequirePackage{xfrac}
\RequirePackage{xpatch}
\RequirePackage{etoolbox}
%\RequirePackage[style=authoryear]{biblatex}




\renewcommand\CancelColor{\color{red!50!orange}}
